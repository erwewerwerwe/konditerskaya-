{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Кондитерская{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    {% block extra_css %}{% endblock %}
</head>
<body>
<header>
    <div class="header-container">
        <div class="logo-container">
            <a href="{% url 'index' %}">
                <img src="{% static 'shop/images/baker.png' %}" alt="Логотип сайта" class="logo-image">
            </a>
        </div>

        <div class="search-catalog-container" style="display: flex; align-items: center; gap: 12px;">
            <nav class="catalog-menu" aria-expanded="false" style="flex-shrink: 0;">
                <button id="catalog-toggle" aria-haspopup="true" aria-expanded="false" type="button"
                        aria-label="Открыть каталог">
                    <span class="bar"></span>
                    <span class="bar"></span>
                    <span class="bar"></span>
                </button>
                <div class="catalog-panel">
                    <div class="catalog-header">Каталог</div>
                    <ul class="catalog-categories">
                        {% for category in categories %}
                        <li>
                            <a href="{{ category.get_absolute_url }}">
                                {% if category.icon %}
                                <img src="{{ category.icon.url }}" alt="{{ category.name }}" class="category-icon">
                                {% endif %}
                                {{ category.name }}
                            </a>
                        </li>
                        {% empty %}
                        <li>Категории отсутствуют</li>
                        {% endfor %}
                    </ul>
                </div>
            </nav>

            <!-- Затемнение фона -->
            <div class="catalog-overlay"></div>

            <!-- Поисковая строка -->
            <div class="search-container" style="flex-grow: 1;">
                <form method="get" action="{% url 'search' %}" class="custom-search-form" novalidate>
                    <input
                            type="search"
                            name="q"
                            placeholder="Поиск товаров..."
                            value="{{ request.GET.q|default:'' }}"
                            autocomplete="off"
                            class="custom-search-input"
                            id="search-input"
                    />
                    <button type="button" class="custom-search-clear" aria-label="Очистить поиск"
                            onclick="document.getElementById('search-input').value=''; this.style.display='none';">
                        &#10006;
                    </button>
                    <button type="submit" class="custom-search-button" aria-label="Поиск">Найти</button>
                </form>
            </div>
        </div>
        <nav class="top-icons-nav">
            {% if user.is_authenticated %}

            <div class="icon-item">
                <a href="{% url 'orders:user_orders' %}" class="icon-link">
                    <img src="{% static 'shop/images/orders.png' %}" alt="Заказы" class="icon-image">
                    <span class="icon-label">Заказы</span>
                </a>
            </div>
            <div class="icon-item">
                <a href="{% url 'profile' %}" class="icon-link">
                    <img src="{% static 'shop/images/profile.png' %}" alt="Профиль" class="icon-image">
                    <span class="icon-label">Профиль</span>
                </a>
            </div>
            <div class="icon-item">
                <a href="{% url 'cart:cart_detail' %}" class="icon-link">
                    <img src="{% static 'shop/images/card1.png' %}" alt="Корзина" class="icon-image">
                    <span class="icon-label">Корзина</span>
                </a>
            </div>
            <div class="icon-item">
                <a href="{% url 'cart:favorites_list' %}" class="icon-link">
                    <img src="{% static 'shop/images/favorites.png' %}" alt="Избранное" class="icon-image">
                    <span class="icon-label">Избранное</span>
                </a>
            </div>
            <div class="icon-item">
                <form method="post" action="{% url 'logout' %}" class="logout-form">
                    {% csrf_token %}
                    <button type="submit" class="icon-button">
                        <img src="{% static 'shop/images/exit.png' %}" alt="Выйти" class="icon-image">
                        <span class="icon-label">Выйти</span>
                    </button>
                </form>
            </div>
            {% else %}
            <div class="icon-item">
                <a href="{% url 'login' %}" class="icon-link">
                    <img src="{% static 'shop/images/enter.png' %}" alt="Войти" class="icon-image">
                    <span class="icon-label">Войти</span>
                </a>
            </div>
            <div class="icon-item">
                <a href="{% url 'register' %}" class="icon-link">
                    <img src="{% static 'shop/images/register.png' %}" alt="Регистрация" class="icon-image">
                    <span class="icon-label">Регистрация</span>
                </a>
            </div>
            {% endif %}
        </nav>
    </div>
</header>

<main>
    {% if messages %}
    <ul class="messages">
        {% for message in messages %}
        <li {% if message.tags %} class="{{ message.tags }}" {% endif %}>{{ message }}</li>
        {% endfor %}
    </ul>
    {% endif %}

    {% block content %}{% endblock %}
</main>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const input = document.getElementById('search-input');
        const clearBtn = document.querySelector('.custom-search-clear');

        function toggleClearBtn() {
            clearBtn.style.display = input.value ? 'inline' : 'none';
        }

        input.addEventListener('input', toggleClearBtn);
        toggleClearBtn();
    });


</script>
<script>
   document.addEventListener('DOMContentLoaded', function() {
        const catalogToggle = document.getElementById('catalog-toggle');
        const catalogMenu = document.querySelector('.catalog-menu');
        const overlay = document.querySelector('.catalog-overlay');

        // Открытие/закрытие каталога
        catalogToggle.addEventListener('click', function(e) {
            e.stopPropagation();
            const isExpanded = catalogMenu.getAttribute('aria-expanded') === 'true';
            catalogMenu.setAttribute('aria-expanded', !isExpanded);
        });

        // Закрытие по клику на overlay
        overlay.addEventListener('click', function() {
            catalogMenu.setAttribute('aria-expanded', 'false');
        });

        // Закрытие по клику вне каталога
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.catalog-menu') && !e.target.closest('.catalog-panel')) {
                catalogMenu.setAttribute('aria-expanded', 'false');
            }
        });

        // Закрытие по ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                catalogMenu.setAttribute('aria-expanded', 'false');
            }
        });
    });

</script>
</body>
</html>


